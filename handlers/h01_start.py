from aiogram import Router, F
from aiogram.types import Message, ReplyKeyboardRemove
from aiogram.filters import CommandStart

from keyboards.reply import get_start_keyboard
from states.creator import Creator
from aiogram.fsm.context import FSMContext
from settings_ai.settings import ask

router = Router()


@router.message(CommandStart())
async def start(message: Message):
    """–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start"""
    await message.answer(
        "–ü—Ä–∏–≤–µ—Ç üëã\n–Ø –≥–æ—Ç–æ–≤ –¥–∞—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å.\n–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ",
        reply_markup=get_start_keyboard()
    )

@router.message(F.text == "I'm ready to talk üëÅ‚Äçüó®")
async def start_chat(message: Message):
    """–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ"""
    await message.answer(
        "–Ø –∂–¥—É —Ç–≤–æ–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞,\n–Ω–∞–ø–∏—à–∏ –µ–≥–æ —Å–∫–æ—Ä–µ–µ üëá",
        reply_markup=ReplyKeyboardRemove()
    )

@router.message(Creator.wait)
async def stop_flood(message: Message):
    """–∑–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞"""
    await message.answer("–í–∞—à –∑–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è,\n–ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ üòä")


@router.message()
async def generate(message: Message, state: FSMContext):
    """–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
    await state.set_state(Creator.wait)
    response = await ask(message.text)
    await message.answer(response)
    await state.clear()
