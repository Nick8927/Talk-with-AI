from aiogram import Router, F
from aiogram.types import Message, ReplyKeyboardRemove, FSInputFile, CallbackQuery
from aiogram.filters import CommandStart

from keyboards.inline import get_learning_menu
from keyboards.reply import get_start_keyboard
from states.creator import Creator
from aiogram.fsm.context import FSMContext
from settings_ai.settings import ask
from data.lessons import daily_routine_words, irregular_verbs


router = Router()


@router.message(CommandStart())
async def start(message: Message):
    """–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start"""
    photo = FSInputFile("media/banner.jpg")
    await message.answer_photo(
        photo=photo,
        caption="–ü—Ä–∏–≤–µ—Ç üëã\n–Ø –≥–æ—Ç–æ–≤ –¥–∞—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å.\n–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ:",
        reply_markup=get_start_keyboard()
    )


@router.message(F.text == "I'm ready to talk üëÅ‚Äçüó®")
async def open_learning_menu(message: Message):
    """–æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–¥–º–µ–Ω—é"""
    await message.answer(
        "–í—ã–±–µ—Ä–∏, —á—Ç–æ —Ö–æ—á–µ—à—å –∏–∑—É—á–∞—Ç—å üëá",
        reply_markup=get_learning_menu()
    )


@router.callback_query(F.data == "learn_daily")
async def learn_daily(callback: CallbackQuery):
    await callback.message.answer(daily_routine_words, parse_mode="Markdown")
    await callback.answer()


@router.callback_query(F.data == "learn_irregular")
async def learn_irregular(callback: CallbackQuery):
    await callback.message.answer(irregular_verbs, parse_mode="Markdown")
    await callback.answer()

@router.message(Creator.wait)
async def stop_flood(message: Message):
    """–∑–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞"""
    await message.answer("–í–∞—à –∑–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è,\n–ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ üòä")


@router.message()
async def generate(message: Message, state: FSMContext):
    """–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
    await state.set_state(Creator.wait)
    response = await ask(message.text)
    await message.answer(response)
    await state.clear()
